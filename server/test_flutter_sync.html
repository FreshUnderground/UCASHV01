<!DOCTYPE html>
<html>
<head>
    <title>Flutter Sync Test</title>
    <meta charset="utf-8">
</head>
<body>
    <h1>Flutter Synchronization Test</h1>
    
    <button onclick="testPing()">Test Ping</button>
    <button onclick="testShopsUpload()">Test Shops Upload</button>
    <button onclick="testShopsDownload()">Test Shops Download</button>
    
    <div id="result" style="margin-top: 20px; padding: 10px; background: #f0f0f0;">
        <h3>Results:</h3>
        <pre id="output"></pre>
    </div>

    <script>
        const baseUrl = 'https://safdal.investee-group.com/server/api/sync';
        
        function log(message) {
            const output = document.getElementById('output');
            output.textContent += message + '\n';
            console.log(message);
        }
        
        async function testPing() {
            log('Testing ping...');
            try {
                const response = await fetch(`${baseUrl}/ping.php`);
                const data = await response.json();
                log(`Ping result: ${JSON.stringify(data, null, 2)}`);
            } catch (error) {
                log(`Ping error: ${error}`);
            }
        }
        
        async function testShopsUpload() {
            log('Testing shops upload...');
            try {
                const testData = {
                    entities: [
                        {
                            id: 1,
                            designation: 'Test Shop',
                            localisation: 'Test Location',
                            capital_initial: 10000,
                            devise_principale: 'USD',
                            devise_secondaire: null,
                            capital_actuel: 10000,
                            capital_cash: 5000,
                            capital_airtel_money: 2000,
                            capital_mpesa: 2000,
                            capital_orange_money: 1000,
                            capital_actuel_devise2: null,
                            capital_cash_devise2: null,
                            capital_airtel_money_devise2: null,
                            capital_mpesa_devise2: null,
                            capital_orange_money_devise2: null,
                            creances: 0,
                            dettes: 0,
                            last_modified_at: new Date().toISOString(),
                            last_modified_by: 'test',
                            created_at: new Date().toISOString(),
                            is_synced: false,
                            synced_at: null
                        }
                    ],
                    user_id: 'admin',
                    timestamp: new Date().toISOString()
                };
                
                const response = await fetch(`${baseUrl}/shops/upload.php`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });
                
                const data = await response.json();
                log(`Shops upload result: ${JSON.stringify(data, null, 2)}`);
            } catch (error) {
                log(`Shops upload error: ${error}`);
            }
        }
        
        async function testShopsDownload() {
            log('Testing shops download...');
            try {
                const since = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString(); // 30 days ago
                const response = await fetch(`${baseUrl}/shops/changes.php?since=${since}&user_id=admin`);
                const data = await response.json();
                log(`Shops download result: ${JSON.stringify(data, null, 2)}`);
            } catch (error) {
                log(`Shops download error: ${error}`);
            }
        }
    </script>
</body>
</html>